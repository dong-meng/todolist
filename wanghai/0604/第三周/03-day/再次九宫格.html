<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        
        ul {
            width: 340px;
            height: 340px;
            border: 10px solid gray;
            position: relative;
            margin: 50px auto;
            border-radius: 10px;
        }
        
        li {
            list-style: none;
            width: 100px;
            height: 100px;
            border-radius: 10px;
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>

<body>
    <ul>
        <li style="top:10px; left:10px;">1</li>
        <li style="top:10px; left:120px;">2</li>
        <li style="top:10px; left:230px;">3</li>
        <li style="top:120px; left:10px;">4</li>
        <li style="top:120px; left:120px;">5</li>
        <li style="top:120px; left:230px;">6</li>
        <li style="top:230px; left:10px;">7</li>
        <li style="top:230px; left:120px;">8</li>
        <li style="top:230px; left:230px;">9</li>
    </ul>


    <script>
        var ul = document.querySelector('ul')
        var lis = document.querySelectorAll('li')
        var startX, startY
        var startLeft, startTop
        var moveX, moveY

        bindEvent()
        addColor()

        function bindEvent() {
            lis.forEach(function(item) {
                item.addEventListener('mousedown', function(e) {
                    e = e || window.event
                        // 相对窗口的位置
                    startX = e.clientX - this.offsetLeft
                    startY = e.clientY - this.offsetTop
                        // 初始位置
                    startLeft = this.offsetLeft
                    startTop = this.offsetTop
                        // console.log(startX, startTop)
                    this.addEventListener('mousemove', move)
                    this.addEventListener('mouseup', up)
                    this.addEventListener('mouseout', out)
                })
                item.addEventListener('selectstart', function(e) {
                    e = e || window.event
                    e.preventDefault()
                })
            })
        }

        function move(e) {
            e = e || window.event
            moveX = e.clientX - startX
            moveY = e.clientY - startY
                // console.log(moveX, moveY)
            if (moveX <= 0) {
                moveX = 0
            }
            if (moveY <= 0) {
                moveY = 0
            }
            if (moveX + this.clientWidth >= ul.clientWidth) {
                moveX = ul.clientWidth - this.clientWidth
            }
            if (moveY + this.clientHeight >= ul.clientHeight) {
                moveY = ul.clientHeight - this.clientHeight
            }
            this.style.left = moveX + 'px'
            this.style.top = moveY + 'px'
            this.style.zIndex = 10
        }

        function up(e) {
            e = e || window.event
            var Athis = this

            var arr = []
            lis.forEach(function(item) {
                if (Athis !== item) {
                    if (Math.abs(Athis.offsetLeft - item.offsetLeft) < Athis.clientWidth && Math.abs(Athis.offsetTop - item.offsetTop) < Athis.clientHeight) {
                        arr.push(item)
                    }
                }
            })

            var maxItem = null
            var maxS = 0
            arr.forEach(function(item) {
                    var x = Athis.clientWidth - Math.abs(Athis.offsetLeft - item.offsetLeft)
                    var y = Athis.clientHeight - Math.abs(Athis.offsetTop - item.offsetTop)
                    if (x * y > maxS) {
                        maxS = x * y
                        maxItem = item
                    }
                })
                // console.log(maxItem)
            if (maxItem === null) {
                Athis.style.left = startLeft + 'px'
                Athis.style.top = startTop + 'px'
            } else {
                Athis.style.left = maxItem.offsetLeft + 'px'
                Athis.style.top = maxItem.offsetTop + 'px'
                maxItem.style.left = startLeft + 'px'
                maxItem.style.top = startTop + 'px'
            }

            console.log(Athis.offsetLeft, Athis.offsetTop)
            this.style.zIndex = 1
            this.removeEventListener('mousemove', move)
            this.removeEventListener('mouseout', out)

        }

        function out(e) {
            e = e || window.event
            this.style.left = startLeft + 'px'
            this.style.top = startTop + 'px'
            this.removeEventListener('mouseup', up)
            this.removeEventListener('mousemove', move)

        }


        function addColor() {
            var arr = ['blue', 'gray', 'orange', 'yellow', 'red', 'green', 'pink', 'purple', 'skyblue']
            lis.forEach(function(items, idx) {
                lis[idx].style.backgroundColor = arr[idx]
            })
        }
    </script>
</body>

</html>